/*
 * Copyright (C) 2014 Matt Kilgore
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License v2 as published by the
 * Free Software Foundation.
 */

#include <protura/types.h>
#include <protura/bits.h>
#include <protura/debug.h>

#include <arch/asm.h>
#include <arch/idt.h>
#include <protura/drivers/term.h>
#include <arch/drivers/keyboard.h>

uint16_t scancode2_to_ascii[][8] =
{
/*    ASCII    +Shift   +Ctrl    +Alt     +Num     +Caps    +Shift +Caps  +Shift +Num */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    { 0x1B,    0x1B,    0x1B,    0x1B,    0x1B,    0x1B,    0x1B,         0x1B },
    /* 1 -> 9, 0 */
    { '1',     '!',     0,       0x7800,  '1',     '1',     '!',          '!' },
    { '2',     '@',     0,       0x7900,  '2',     '2',     '@',          '@' },
    { '3',     '#',     0,       0x7A00,  '3',     '3',     '#',          '#' },
    { '4',     '$',     0,       0x7B00,  '4',     '4',     '$',          '$' },
    { '5',     '%',     0,       0x7C00,  '5',     '5',     '%',          '%' },
    { '6',     '^',     0,       0x7D00,  '6',     '6',     '^',          '^' },
    { '7',     '&',     0,       0x7E00,  '7',     '7',     '&',          '&' },
    { '8',     '*',     0,       0x7F00,  '8',     '8',     '*',          '*' },
    { '9',     '(',     0,       0x8000,  '9',     '9',     '(',          '(' },
    { '0',     ')',     0,       0x8100,  '0',     '0',     ')',          ')' },
    /* - */
    { '-',     '_',     0x1F,    0x8200,  '-',     '-',     '_',          '_' },
    /* = */
    { '=',     '+',     0,       0x8300,  '=',     '=',     '+',          '+' },
    /* Backspace */
    { 0x7F,    0x7F,    '\b',    0,       0x7F,    0x7F,    0x7F,         0x7F },
    /* Tab */
    { '\t',    0x0F00,  0,       0,       '\t',    '\t',    0x0F00,       0x0F00 },
    /* "qwertyuiop[] */
    { 'q',     'Q',     0x11,    0x1000,  'q',     'Q',     'q',          'Q' },
    { 'w',     'W',     0x17,    0x1100,  'w',     'W',     'w',          'W' },
    { 'e',     'E',     0x05,    0x1200,  'e',     'E',     'e',          'E' },
    { 'r',     'R',     0x12,    0x1300,  'r',     'R',     'r',          'R' },
    { 't',     'T',     0x14,    0x1400,  't',     'T',     't',          'T' },
    { 'y',     'Y',     0x19,    0x1500,  'y',     'Y',     'y',          'Y' },
    { 'u',     'U',     0x15,    0x1600,  'u',     'U',     'u',          'U' },
    { 'i',     'I',     0x09,    0x1700,  'i',     'I',     'i',          'I' },
    { 'o',     'O',     0x0F,    0x1800,  'o',     'O',     'o',          'O' },
    { 'p',     'P',     0x10,    0x1900,  'p',     'P',     'p',          'P' },
    { '[',     '{',     0x1B,    0,       '[',     '[',     '{',          '{' },
    { ']',     '}',     0x1D,    0,       ']',     ']',     '}',          '}' },
    /* Enter */
    { '\n',    '\n',    0x0D,    0,       '\n',    '\n',    0x0D,         0x0D },
    /* Ctrl */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* "asdfghjkl;'`" - In that order */
    { 'a',     'A',     0x01,    0x1E00,  'a',     'A',     'a',          'A' },
    { 's',     'S',     0x13,    0x1F00,  's',     'S',     's',          'S' },
    { 'd',     'D',     0x04,    0x2000,  'd',     'D',     'd',          'D' },
    { 'f',     'F',     0x06,    0x2100,  'f',     'F',     'f',          'F' },
    { 'g',     'G',     0x07,    0x2200,  'g',     'G',     'g',          'G' },
    { 'h',     'H',     0x08,    0x2300,  'h',     'H',     'h',          'H' },
    { 'j',     'J',     0x0A,    0x2400,  'j',     'J',     'j',          'J' },
    { 'k',     'K',     0x0B,    0x2500,  'k',     'K',     'k',          'K' },
    { 'l',     'L',     0x0C,    0x2600,  'l',     'L',     'l',          'L' },
    { ';',     ':',     0,       0,       ';',     ';',     ':',          ':' },
    { '\'',    '"',     0,       0,       '\'',    '\'',    '"',          '"' },
    { '`',     '~',     0,       0,       '`',     '`',     '~',          '~' },
    /* Left shift */
    { 0x2A,    0,       0,       0,       0,       0,       0,            0 },
    /* "\zxcvbnm,./" - In that order */
    { '\\',    '|',     0x1C,    0,       '\\',    '\\',    '|',          '|' },
    { 'z',     'Z',     0x1A,    0x2C00,  'z',     'Z',     'z',          'Z' },
    { 'x',     'X',     0x18,    0x2D00,  'x',     'X',     'x',          'X' },
    { 'c',     'C',     0x03,    0x2E00,  'c',     'C',     'c',          'C' },
    { 'v',     'V',     0x16,    0x2F00,  'v',     'V',     'v',          'V' },
    { 'b',     'B',     0x02,    0x3000,  'b',     'B',     'b',          'B' },
    { 'n',     'N',     0x0E,    0x3100,  'n',     'N',     'n',          'N' },
    { 'm',     'M',     0x0D,    0x3200,  'm',     'M',     'm',          'M' },
    { ',',     '<',     0,       0,       ',',     ',',     '<',          '<' },
    { '.',     '>',     0,       0,       '.',     '.',     '>',          '>' },
    { '/',     '?',     0,       0,       '/',     '/',     '?',          '?' },
    /* Right shift */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* Print Screen */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* Alt */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* Space */
    { ' ',     ' ',     ' ',     0,       ' ',     ' ',     ' ',          ' ' },
    /* Caps */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* F1 - F10 */
    { 0x3B00,  0x5400,  0x5E00,  0x6800,  0x3B00,  0x3B00,  0x5400,       0x5400 },
    { 0x3C00,  0x5500,  0x5F00,  0x6900,  0x3C00,  0x3C00,  0x5500,       0x5500 },
    { 0x3D00,  0x5600,  0x6000,  0x6A00,  0x3D00,  0x3D00,  0x5600,       0x5600 },
    { 0x3E00,  0x5700,  0x6100,  0x6B00,  0x3E00,  0x3E00,  0x5700,       0x5700 },
    { 0x3F00,  0x5800,  0x6200,  0x6C00,  0x3F00,  0x3F00,  0x5800,       0x5800 },
    { 0x4000,  0x5900,  0x6300,  0x6D00,  0x4000,  0x4000,  0x5900,       0x5900 },
    { 0x4100,  0x5A00,  0x6400,  0x6E00,  0x4100,  0x4100,  0x5A00,       0x5A00 },
    { 0x4200,  0x5B00,  0x6500,  0x6F00,  0x4200,  0x4200,  0x5B00,       0x5B00 },
    { 0x4300,  0x5C00,  0x6600,  0x7000,  0x4300,  0x4300,  0x5C00,       0x5C00 },
    { 0x4400,  0x5D00,  0x6700,  0x7100,  0x4400,  0x4400,  0x5D00,       0x5D00 },
    /* Num Lock */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* Scroll Lock */
    { 0,       0,       0,       0,       0,       0,       0,            0 },
    /* Home */
    { 0x4700,  0x37,    0x7700,  0,       0x37,    0x4700,  0x37,         0x4700 },
    /* Up */
    { 0x4800,  0x38,    0,       0,       0x38,    0x4800,  0x38,         0x4800 },
    /* Page up */
    { 0x4900,  0x39,    0x8400,  0,       0x39,    0x4900,  0x39,         0x4900 },
    /* - keypad */
    { 0x2D,    0x2D,    0,       0,       0x2D,    0x2D,    0x2D,         0x2D },
    /* left */
    { 0x4B00,  0x34,    0x7300,  0,       0x34,    0x4B00,  0x34,         0x4B00 },
    /* Center */
    { 0x4C00,  0x35,    0,       0,       0x35,    0x4C00,  0x35,         0x4C00 },
    /* Right */
    { 0x4D00,  0x36,    0x7400,  0,       0x36,    0x4D00,  0x36,         0x4D00 },
    /* + keypad */
    { 0x2B,    0x2B,    0,       0,       0x2B,    0x2B,    0x2B,         0x2B },
    /* End */
    { 0x4F00,  0x31,    0x7500,  0,       0x31,    0x4F00,  0x31,         0x4F00 },
    /* Down */
    { 0x5000,  0x32,    0,       0,       0x32,    0x5000,  0x32,         0x5000 },
    /* Page Down */
    { 0x5100,  0x33,    0x7600,  0,       0x33,    0x5100,  0x33,         0x5100 },
    /* Insert */
    { 0x5200,  0x30,    0,       0,       0x30,    0x5200,  0x30,         0x5200 },
    /* Delete */
    { 0x5300,  0x2E,    0,       0,       0x2E,    0x5300,  0x2E,         0x5300 }
};

